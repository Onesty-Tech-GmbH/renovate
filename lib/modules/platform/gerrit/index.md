# Gerrit

## Authentication

First, ![HTTP access token](gerrit-http-password.png) for the bot account.

Let Renovate use your HTTP access token by doing _one_ of the following:

- Set your HTTP access token as a `password` in your `config.js` file
- Set your HTTP access token as an environment variable `RENOVATE_PASSWORD`
- Set your HTTP access token when you run Renovate in the CLI with `--password=`

Make sure this user is allowed to assign the Code-Review label with "+2" to his own changes or "automerge" can't work.

Remember to set `platform=gerrit` somewhere in your Renovate config file.

## Branch-Model with Gerrit

**The Gerrit-Platform don't use/needs branches for generating "pull-requests".**
They are not necessary and registered-users are not allowed (as default) to push new references (branches/tags).

The pull-request branch names generated by renovate will be transformed to "Gerrit-Topics" on a base-branch. This is needed to identify each change (branch-pull-request) uniquely.
Alternatively Hashtags can be used instead of Topics.

**Therefore you have to set the following options**

```
{
  platformCommit: true, //reuse Change-Id
  gitNoVerify: ["push"], //allow-commit-hook
  branchPrefix: "master%topic=", //transform branchname into topic or master%t= to use hashtags
  onboardingBranch: "master%topic=renovate-config",
}
```

Replace `master` with your base-branch.
For HashTags use `%t=` instead of `%topic=` inside the branchPrefix configuration.

## Unsupported platform features/concepts

- Creating issues (not a gerrit concept) / Dashboard.
- multiple `baseBranches` (conversion to topic/hashtag then needs to be dynamic, see `branchPrefix` above)

## Features awaiting implementation

- convert "pull-request" body to Gerrits "Markdown" Syntax
- Adding/removing labels
- How to "ignore" a PR from user/developer perspective? Vote with -2 and then renovate "abandon" the PR on next run?
- The `automergeStrategy` configuration option has not been implemented for this platform, and all values behave as if the value `auto` was used. Renovate will use the merge strategy configured in the Gerrit repository itself, and this cannot be overridden yet
- Fill pr.bodyStruct?.rebaseRequested , see shouldReuseExistingBranch()
- isBranchStale(branchName: string) don't work, returns always = true
